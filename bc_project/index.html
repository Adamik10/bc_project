<% /*Add this to engage logon requirement */ %>
<%@ page import="xtk:shared/nl.js" %>
<% NL.require('xtk:jsspcontext.js'); %>
<%
  if( !(new NL.JSSPContext(request)).checkAuthentication(response) )
    return;
%>

<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
  <!-- below is FONT -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet">
  <!-- below is vuetify -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
  <!-- below is vue functionalities -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
  <!-- AXIOS -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- below is lodash -->
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
  <!-- below is moment -->
  <script src="https://momentjs.com/downloads/moment-with-locales.js"></script>
  <!-- below is material icons -->
  <link rel="icon" sizes="192x192" href="https://material.io/static/images/simple-lp/favicons/components-192x192.png">
  <link rel="shortcut icon" href="https://material.io/static/images/simple-lp/favicons/components-72x72.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/6.0.0/normalize.min.css">
  <!-- below is bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- below css is temporary -->
  <link rel="stylesheet" type="text/css" href="<%= getOption('test_offersDashboardCssFile') %>">
</head>

<body id="mother-loader" style="visibility: hidden">
  <v-app id="app">
    <!-- Navigation -------------------------------------------------------------------------------------------------------->   
    <v-toolbar  absolute 
                dark 
                color="#3A9EF0"
                height="70px">
      <v-toolbar-side-icon  @click.native.stop="sidebar = !sidebar"></v-toolbar-side-icon>
      <v-toolbar-title class="white--text">Offer Dashboard</v-toolbar-title>
      <v-spacer></v-spacer>
      <img src="http://unilever-stage.neolane.net/res/unilever_stage/logo_white.png" alt="logo" class="navLogo" style="margin-right: 300px;">
      <v-spacer></v-spacer>
    </v-toolbar>
    <v-navigation-drawer  v-model="sidebar"
                          absolute
                          width="400px"
                          temporary>
      <v-list>
        <div class="sidebar-spacer">
          <v-icon class="close"
                  @click="sidebar = false">
              close
          </v-icon>
        </div>
        <template v-for="subPage in subPages">
          <v-list-tile  :key="subPage.id"
                        @click="redirectTo(subPage.link)"
                        class="sidebar-tile">
            <v-list-tile-action class="action-margin-left">
              <div class="action-icon-circle">
                <v-icon color="white"
                        class="icon">
                  {{ subPage.icon }}
                </v-icon>
              </div>
            </v-list-tile-action>
            <v-subheader class="mx-4">
              {{ subPage.name }}
            </v-subheader>
          </v-list-tile>
        </template>
      </v-list>
    </v-navigation-drawer>
    <div class="nav-spacer"></div>
    <!-- Navigation ends -->

    <!-- Content -->
    <v-container grid-list-xl>
      <!-- Filters -------------------------------------------------------------------------------------------------------->
      <template v-if="filters != undefined">
        <v-container class="dropdownContainer">
          <v-select :items="filters.countries"
                    v-model="filtersSelected.country"
                    label="Country"
                    item-text="marketLabel"
                    item-value="marketCountryCode"
                    clearable dense single-line solo flat
                    class="basicDropdown"
                  :menu-props="{contentClass:'basicDropdownContent'}">
            <template slot="selection" slot-scope="data">
              {{ data.item.marketLabel | maxLength(13) }}
            </template>
          </v-select>
        </v-container>
        <v-container class="dropdownContainer">
          <v-select :items="staticFilters.categories"
                    v-model="filtersSelected.category"
                    label="Category"
                    item-text="categoryLabel"
                    item-value="categoryRef"
                    clearable dense single-line solo flat
                    class="basicDropdown"
                  :menu-props="{contentClass:'basicDropdownContent'}">
            <template slot="selection" slot-scope="data">
              {{ data.item.categoryLabel | maxLength(12) }}
            </template>
          </v-select>
        </v-container>
        <v-container class="dropdownContainer">
          <v-select :items="staticFilters.status"
                    v-model="filtersSelected.status"
                    label="Status"
                    item-text="name"
                    item-value="name"
                    clearable dense single-line solo flat
                    class="basicDropdown"
                    :menu-props="{contentClass:'basicDropdownContent'}">
            <template slot="selection" slot-scope="data">
              {{ data.item.name | maxLength(13) }}
            </template>
          </v-select>
        </v-container>
        <v-container class="inputContainer">
          <v-text-field v-model="filtersSelected.label"
                        label="Label contains"
                        class="basicInput">
          </v-text-field>
        </v-container>
        <div style="display: inline-block; width: 100px; padding-left: 20px">
          <v-checkbox v-model="filtersSelected.default" class="checkbox"
            label="Default" color="#3A9EF0" >
          </v-checkbox>
        </div>
      </template>
      <!-- Filters end -->
      <v-divider ></v-divider>
      <!-- Search results ---------------------------------------------------------------------------------- -->
      <template v-if="isLoadingOffers != true">
        <div class="sub-filter-row">
          <p style="margin-top: -8px;">
            <template v-if='filtersSelected.lineCount == 12'>
              <b>12</b>
            </template>
            <template v-else>
              <span class="display-as-link" @click="filtersSelected.lineCount = 12">12</span>
            </template>
             | 
            <template v-if='filtersSelected.lineCount == 24'>
              <b>24</b>
            </template>
            <template v-else>
              <span class="display-as-link" @click="filtersSelected.lineCount = 24">24</span>
            </template>
              | 
            <template v-if='filtersSelected.lineCount == 48'>
              <b>48</b>
            </template>
            <template v-else>
              <span class="display-as-link" @click="filtersSelected.lineCount = 48">48</span>
            </template>
          </p>
        </div>
        <template v-if="offers.length">
          <v-hover v-for="(offer,i) in offers" :key="i">
            <v-card class="baseCard clickable align-top" 
                    align="top"
                    slot-scope="{ hover }"
                    :class="`elevation-${hover ? 12 : 2}`"
                    @click="openDetailView(offer)">
              <v-card-title primary-title class="card-title" >
                <div class="status-container" :class="{greenBackground: offer.statusLive == 6, redBackground: offer.statusLive != 6}"></div>
                <h3 class="headline" :title="offer.offerLabel">{{ offer.offerLabel | maxLength(30) }} </h3>
                <v-card-text>
                  <p class="offer-category">{{ offer.categoryInternalName | makeIntoCategory }}</p>
                  <div><b>SL 1:</b>
                    {{offer.subject1}}</div>
                <div><b>SL 2:</b>
                    {{offer.subject2}}</div>
                <div><b>Pre Header:</b>
                  {{offer.preheader}}</div>
                </v-card-text>
              
              </v-card-title>
              <div v-if="offer.imageDesktopURL" style="position: relative; width: 100%;">
                <v-img :src="'http://'+offer.imageDesktopURL" 
                      aspect-ratio="2">
                  <template v-slot:placeholder>
                      <v-layout fill-height
                        align-center
                        justify-center
                        ma-0>
                        <v-progress-circular indeterminate color="grey"></v-progress-circular>
                    </v-layout>
                  </template>
                </v-img>
              </div>
              <v-card-title class="text-center center">
                <div v-if="offer.headline" class="margin-auto offer-content" style="font-family:Verdana; font-weight:bold; mso-line-height-rule:exactly; line-height:22px !important; font-size:21px; color:#ff5a00; padding:0 0 8px 0;">{{offer.headline}}</div>
                <div v-if="offer.copyText" class="offer-content" style="padding: 0 0 16px 0">{{offer.copyText}}</div>
                <div v-if="offer.CTAtext" style="margin: auto; padding:6px 14px; -webkit-border-radius:4px; border-radius:4px; font-size:14px; font-family:Verdana; color:#ffffff; display:inline-block; border:1px solid #ff5a00; background-color: #ff5a00;">
                  <span style="font-size:14px; font-family:Verdana; text-decoration:none; font-weight:bold; mso-line-height-rule:exactly; 
                    line-height:14px !important; color:#ffffff;" target="_blank">{{offer.CTAtext}}</span>
                </div>
              </v-card-title>
            </v-card>
          </v-hover>
          <template v-if="!noMoreOffersToLoad">
            <v-btn v-on:click="loadMoreOffers()" 
                    class="full-width"
                    color="rgb(192, 192, 192)"
                    outline flat center>
              <template v-if="!isLoadingMoreOffers">
                Load more
              </template>
              <template v-else>
                <div class="text-xs-center">
                  <v-progress-circular
                    :size="20" :width="3"
                    color="rgb(192, 192, 192)"
                    indeterminate></v-progress-circular>
                </div>
              </template>
            </v-btn>
          </template>
        </template>
        
        <template v-else>
          <v-container>There are no offers to display</v-container>
        </template>
      </template>
      <template v-else>
          <div class="text-xs-center">
            <v-progress-circular style="margin-top: 50px;"
              :size="50" :width="3"
              color="rgb(192, 192, 192)"
              indeterminate></v-progress-circular>
          </div>
      </template>

      <v-btn fab dark class="blueBackground addNewButton" @click="openNewOfferDialog()"
        fixed right top>
          <v-icon dark>add</v-icon>
      </v-btn>
      <!-- Search results end  -->
    </v-container>
    <!-- Detailed offer view -------------------------------------------------------------------------------------------------------->
    <v-dialog v-model="detailOfferView" 
      fullscreen hide-overlay  @keydown.esc="closeDetailView()"
      transition="dialog-bottom-transition"
      content-class="detailViewContent">
      <v-card v-if="detailOfferData != {} && detailOfferData != undefined && detailOfferData != null">
        <v-toolbar dark class="detail-view-toolbar" :class="{greenBackground: detailOfferData.statusLive == 6, redBackground: detailOfferData.statusLive != 6}">
          <v-toolbar-title class="long-title">{{ detailOfferData.offerLabel }}</v-toolbar-title>
          <v-spacer></v-spacer>
          <div v-if="detailOfferData.statusLive == 6" style="width: 210px; min-width: 210px; font-weight: 700;">Current status: LIVE</div>
          <div v-else style="width: 232px; min-width: 232px; font-weight: 700;">Current status: DISABLED</div>
          <v-btn icon dark @click="closeDetailView()">
            <v-icon>close</v-icon>
          </v-btn>
        </v-toolbar>
        <div class="display-flex">
          <div class="mobile-preview">
            <v-subheader class="center-text full-width"><p class="center-text full-width">Mobile preview - {{ detailOfferBlockName }}</p></v-subheader>
            <div class="mobile-preview__container">
              <img src="http://unilever-stage.neolane.net/res/unilever_stage/a48bed274267d6735f4a0dc9435c9dfc.png" alt="phone" class="phone">
              <div class="mobile-preview__container-content">
                <!-- Mobile preview -->
                <table border="0" width="100%" cellpadding="0" cellspacing="0" bgcolor="#ffffff" style="border-collapse: collapse">
                  <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit;">
                    <tr style="display: table-row; vertical-align: inherit; border-color: inherit; border-collapse: collapse">
                      <td align="center" valign="top">
                        <table border="0" width="100%" cellpadding="0" cellspacing="0" bgcolor="#ffffff" style="width:100%!important;max-width:100%!important; border-collapse:collapse">
                          <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit; border-collapse: collapse">
                            <tr style="display: table-row; vertical-align: inherit; border-color: inherit; border-collapse:collapse">
                              <td align="left" valign="top" style="padding:0 10px 30px 10px;" style="padding-left: 0 !important; padding-right:0!important">
                                <table border="0" width="100%" cellspacing="0" cellpadding="0">
                                  <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit;">
                                    <tr style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                      <th valign="top" style="font-weight: normal; padding: 0; vertical-align: top; display: block; padding-right: 0 !important; 
                                        padding-left: 0 !important; width: 100%;">
                                        <table cellpadding="0" cellspacing="0" style="height:381px;table-layout: fixed; margin-top:30px !important; 
                                          width: 100% !important; max-width: 100% !important; border-collapse: collapse;" align="left" border="0">
                                          <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit; border-collapse: collapse;">
                                            <tr style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                              <td v-if="detailOfferData.headline && detailOfferData.headline != '' && detailOfferData.headline != undefined && detailOfferData.headline != null" 
                                                style="font-family:Verdana; color:#000000; font-size:17px; mso-line-height-rule:exactly; line-height:20px; 
                                                height: 90px; overflow: hidden; max-width: 173px; max-height: 120px;" valign="top" align="left">
                                                {{ detailOfferData.headline }}
                                              </td>
                                            </tr>
                                            <tr style="display:none; width:0; max-height:0; overflow:hidden; float:left; display: table-row !important;
                                              width: auto !important; max-height: inherit !important; overflow: visible !important; float: none !important;">
                                              <td style="display:none; width:0; max-height:0; overflow:hidden; float:left; display: table-cell !important;
                                                width: auto !important; max-height: inherit !important; overflow: visible !important; float: none !important;">
                                                <a :href="detailOfferData.destinationURL" target="_blank" style="text-decoration:none; color: -webkit-link; cursor: pointer;">
                                                  <template v-if="detailOfferData.imageMobileURL && detailOfferData.imageMobileURL != '' && detailOfferData.imageMobileURL != undefined && detailOfferData.imageMobileURL != null">
                                                    <v-img :src="'http://'+detailOfferData.imageMobileURL" :alt="detailOfferData.imageAltText" border="0" 
                                                      style="display: block; width: 265px">
                                                      <template v-slot:placeholder>
                                                        <v-layout fill-height
                                                            align-center
                                                            justify-center
                                                            ma-0>
                                                            <v-progress-circular indeterminate color="grey"></v-progress-circular>
                                                        </v-layout>
                                                      </template>
                                                    </v-img>
                                                  </template>
                                                  <template v-else>
                                                    <img v-if="detailOfferData.imageDesktopURL && detailOfferData.imageDesktopURL != '' && detailOfferData.imageDesktopURL != undefined && detailOfferData.imageDesktopURL != null"
                                                      :src="'http://'+detailOfferData.imageDesktopURL" :alt="detailOfferData.imageAltText" border="0" 
                                                      style="display: block; width: 265px"/>
                                                  </template>
                                                </a>
                                              </td>
                                            </tr>
                                            <tr v-if="detailOfferData.copyText && detailOfferData.copyText != '' && detailOfferData.copyText != undefined && detailOfferData.copyText != null"
                                              style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                              <td align="left" valign="top" style="font-family:Verdana; line-height:17px; font-size:13px; 
                                                color:#000000; padding:16px 0 16px 0;">
                                                {{ detailOfferData.copyText }}
                                              </td>
                                            </tr>
                                            <tr v-if="detailOfferData.CTAtext && detailOfferData.CTAtext != '' && detailOfferData.CTAtext != undefined && detailOfferData.CTAtext != null"
                                                style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                              <td align="center" style="padding:0 0 0 0; border-collapse: collapse">
                                                <table style="border-collapse: collapse">
                                                  <tbody>
                                                    <tr>
                                                      <th bgcolor="#ff5a00" style="padding:6px 14px; -webkit-border-radius:4px; border-radius:4px; font-size:14px; 
                                                          font-family:Verdana; color:#ffffff; display:inline-block; border:1px solid #ff5a00;">
                                                        <a :href="detailOfferData.destinationURL" style="font-size:14px; font-family:Verdana;line-height:14px; 
                                                            text-decoration:none; font-weight:bold; mso-line-height-rule:exactly; color:#ffffff;" target="_blank">
                                                          {{ detailOfferData.CTAtext }}
                                                        </a>  
                                                      </th>
                                                    </tr>
                                                  </tbody>
                                                </table>
                                              </td>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </th>
                                    </tr>
                                  </tbody>
                                </table>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <!-- Mobile preview ends -->
              </div>
            </div>
          </div>
          <div class="desktop-preview">
            <v-subheader class="center-text full-width" style="width: 900px"><p class="center-text full-width">Desktop preview - {{ detailOfferBlockName }}</p></v-subheader>
            <div class="desktop-preview__container">
              <div class="desktop-preview__container-content">
                <!-- Desktop preview -->
                <table width="100%" cellpadding="0" cellspacing="0" bgcolor="#ffffff">
                  <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit; border-collapse: collapse">
                    <tr style="display: table-row; vertical-align: inherit; border-color: inherit;">
                      <td align="center" valign="top" style="border-collapse: collapse">
                        <table cellpadding="0" cellspacing="0" bgcolor="#ffffff" style="width:600px; border-collapse: collapse;">
                          <tbody style="display: table-row-group; vertical-align: middle; ">
                            <tr style="display: table-row; vertical-align: inherit;">
                              <td align="left" valign="top" style="border-collapse: collapse">
                                <table style="border:0; width:100%">
                                  <tbody style="display: table-row-group">
                                    <tr style="display: table-row;">
                                      <td style="padding:0 10px 16px 10px">
                                        <a :href="detailOfferData.destinationURL" target="_blank">
                                          <v-img v-if="detailOfferData.imageDesktopURL && detailOfferData.imageDesktopURL != '' && detailOfferData.imageDesktopURL != undefined && detailOfferData.imageDesktopURL != null"
                                            :src="'http://'+detailOfferData.imageDesktopURL" :alt="detailOfferData.imageAltText" style="display:block; width: 580px;">
                                            <template v-slot:placeholder>
                                              <v-layout fill-height
                                                  align-center
                                                  justify-center
                                                  ma-0>
                                                  <v-progress-circular indeterminate color="grey"></v-progress-circular>
                                              </v-layout>
                                            </template>
                                        </a>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </td>
                            </tr>
                            <tr style="display: table-row;">
                              <td dir="ltr" valign="top" style="padding:0 20px 0 20px; border-collapse: collapse">
                                <table border="0" width="100%" cellpadding="0" cellspacing="0">
                                  <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit;">
                                    <tr v-if="detailOfferData.headline && detailOfferData.headline != '' && detailOfferData.headline != undefined && detailOfferData.headline != null"
                                      style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                      <td align="left" valign="top" style="font-family:Verdana; font-weight:bold; font-size:21px; color:#ff5a00; padding:0 0 8px 0;">
                                        {{ detailOfferData.headline }}
                                      </td>
                                    </tr>
                                    <tr v-if="detailOfferData.copyText && detailOfferData.copyText != '' && detailOfferData.copyText != undefined && detailOfferData.copyText != null"
                                        style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                      <td align="left" valign="top" style="font-family:Verdana; line-height:17px; font-size:13px; color:#000000; padding:0 0 16px 0;">
                                        {{ detailOfferData.copyText }}
                                      </td>
                                    </tr>
                                    <tr v-if="detailOfferData.CTAtext && detailOfferData.CTAtext != '' && detailOfferData.CTAtext != undefined && detailOfferData.CTAtext != null"
                                        style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                      <td align="center" style="padding:0 0 0 0; border-collapse: collapse">
                                        <table style="border-collapse: collapse">
                                          <tbody>
                                            <tr>
                                              <th bgcolor="#ff5a00" style="padding:6px 14px; -webkit-border-radius:4px; border-radius:4px; font-size:14px; 
                                                  font-family:Verdana; color:#ffffff; display:inline-block; border:1px solid #ff5a00;">
                                                <a :href="detailOfferData.destinationURL" style="font-size:14px; font-family:Verdana;line-height:14px; 
                                                    text-decoration:none; font-weight:bold; mso-line-height-rule:exactly; color:#ffffff;" target="_blank"> 
                                                  {{ detailOfferData.CTAtext }}
                                                </a>  
                                              </th>
                                            </tr>
                                          </tbody>
                                        </table>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <!-- Desktop preview ends -->
              </div>
            </div>
            <div class="spacer"></div>
            <v-flex>
              <div class="view-actions" style="width: 900px;">
                <v-tooltip top open-delay="300">
                  <template v-slot:activator="{ on }">
                    <div class="icon-container" :class="{ active: detailOfferBlock == 'mainOneColumn' }" 
                      @click="detailOfferBlock = 'mainOneColumn', detailOfferBlockName = 'Main One Column'" v-on="on">
                      <v-icon color="white" 
                              class="icon" 
                              :class="{ active: detailOfferBlock == 'mainOneColumn' }">
                              filter_1
                      </v-icon> 
                    </div>
                  </template>
                  <span>Main column 1</span>
                </v-tooltip>
                <div class="icon-divider"></div>
                <v-tooltip top open-delay="300">
                  <template v-slot:activator="{ on }">
                    <div class="icon-container" :class="{ active: detailOfferBlock == 'mainTwoColumn' }" 
                      @click="detailOfferBlock = 'mainTwoColumn', detailOfferBlockName = 'Main Two Column'" v-on="on">
                      <v-icon color="white" 
                              class="icon" 
                              :class="{ active: detailOfferBlock == 'mainTwoColumn' }">
                              filter_2
                      </v-icon> 
                    </div>
                  </template>
                  <span>Main column 2</span>
                </v-tooltip>
                <div class="icon-divider"></div>
                <v-tooltip top open-delay="300">
                  <template v-slot:activator="{ on }">
                    <div class="icon-container" :class="{ active: detailOfferBlock == 'ecommerce' }" 
                      @click="detailOfferBlock = 'ecommerce', detailOfferBlockName = 'Ecommerce block'" v-on="on">
                      <v-icon color="white" 
                              class="icon" 
                              :class="{ active: detailOfferBlock == 'ecommerce' }">
                              view_week
                      </v-icon> 
                    </div>
                  </template>
                  <span>Ecommerce block</span>
                </v-tooltip>
                <div class="icon-divider"></div>
                <v-tooltip top open-delay="300">
                  <template v-slot:activator="{ on }">
                    <div class="icon-container" :class="{ active: detailOfferBlock == 'split' }" 
                      @click="detailOfferBlock = 'split', detailOfferBlockName = '50/50 Split'" v-on="on">
                      <v-icon color="white" 
                              class="icon rotateIcon" 
                              :class="{ active: detailOfferBlock == 'split' }">
                              view_agenda
                      </v-icon> 
                    </div>
                  </template>
                  <span>Split 50/50</span>
                </v-tooltip>
              </div>
            </v-flex>
          </div>
          <div class="sidebar">
            <div class="full-width">
              <div class="basicInputContainer align-top" :class="{ 'partial-width' : sendingProof, 'disappear' : !sendingProof }">
                <v-text-field v-model="proofEmailAddress"
                              label="Recipient email"
                              class="basicInput">
                  <template slot="append">
                    <v-icon v-if="sendingProof" @click="sendingProof = false; proofEmailAddress = ''">clear</v-icon>
                  </template>
                </v-text-field>
              </div>
              <v-btn class="base-button align-top" :class="{ 'almost-full-width' : !sendingProof, 'partial-width' : sendingProof }" 
                flat outline @click="sendTheOfferProof(); sendingProof = true">
                <template v-if="!sendingProof">
                  Send a proof to yourself
                </template>
                <template v-else>
                  Send
                </template>
              </v-btn>
            </div>
            <div class="spacer-big"></div>
            <template v-if="detailOfferData.categoryInternalName">
              <p class="offer-category detail">Category: {{ detailOfferData.categoryInternalName | makeIntoCategory }}</p>
              <div class="spacer"></div>
            </template>
            <v-subheader class="no-padding">Subject Line 1</v-subheader>
            <p v-if="detailOfferData.subject1 && detailOfferData.subject1 != '' && detailOfferData.subject1 != undefined" 
              class="minus-margin">{{ detailOfferData.subject1 }}</p>
            <p v-else class="minus-margin"><i>Undefined</i></p>
            <v-subheader class="no-padding">Subject Line 2</v-subheader>
            <p v-if="detailOfferData.subject2 && detailOfferData.subject2 != '' && detailOfferData.subject2 != undefined"
              class="minus-margin">{{ detailOfferData.subject2 }}</p>
            <p v-else class="minus-margin"><i>Undefined</i></p>
            <v-subheader class="no-padding">Preheader</v-subheader>
            <p v-if="detailOfferData.preheader && detailOfferData.preheader != '' && detailOfferData.preheader != undefined"
              class="minus-margin">{{ detailOfferData.preheader }}</p>
            <p v-else class="minus-margin"><i>Undefined</i></p>
            <div class="spacer-big"></div>
            <div class="spacer-big"></div>
            <template v-if="detailOfferData.categoryInternalName && detailOfferData.eligibility.length">
              <template v-if="!doesStringContain(detailOfferData.categoryInternalName, eligibleSubstrings)">
                <v-subheader class="no-padding">Eligibility</v-subheader>
                <template v-if="detailOfferData.eligibility">
                  <div v-for="(eligibility, i) in detailOfferData.eligibility" class="display-flex" :key="i">
                    <div class="half-width">
                      <p v-if="eligibility.label && eligibility.label != '' && eligibility.label != undefined">
                        <b>{{ eligibility.label }}</b>
                      </p>
                      <p v-else>
                        <b><i>No label</i></b>
                      </p>
                      <p v-if="eligibility.weight && eligibility.weight != '' && eligibility.weight != undefined">
                        Weight {{ eligibility.weight }}
                      </p>
                      <p v-else>
                        <i>No weight</i>
                      </p>
                    </div>
                    <div class="half-width align-right">
                      <p v-if="eligibility.startDate && eligibility.startDate != '' && eligibility.startDate != undefined">
                        Start: {{ eligibility.startDate | formatDate("DD/M/YYYY") }}
                      </p>
                      <p v-else>
                        Start: --
                      </p>
                      <p v-if="eligibility.endDate && eligibility.endDate != '' && eligibility.endDate != undefined">
                        End: {{ eligibility.endDate | formatDate("DD/M/YYYY") }}
                      </p>
                      <p v-else>
                        End --
                      </p>
                    </div>
                  </div>
                </template>
                <template v-else>
                  <p>There is no eligibility data.</p>
                </template>
              </template>
            </template>
            <template v-if="detailOfferData.categoryInternalName">
              <div class="spacer-big"></div>
              <template v-if="doesStringContain(detailOfferData.categoryInternalName, eligibleSubstrings)">
                <template v-if="detailOfferData.statusLive != 6">
                  <v-btn class="base-button full-width bottom-actions" 
                    :disabled="loading"
                    color="#6DC570" outline
                    @click.native="dispatcher(detailOfferData.offerId, detailOfferData.offerLabel, detailOfferData.categoryInternalName, 'enable', 'normal')">
                    <template v-if="!loading">
                      Enable offer
                    </template>
                    <template v-else>
                      <div class="text-xs-center">
                        <v-progress-circular
                          :size="20" :width="3"
                          color="rgb(192, 192, 192)"
                          indeterminate></v-progress-circular>
                      </div>
                    </template>
                  </v-btn>
                </template>
                <template v-else>
                  <v-btn class="base-button full-width bottom-actions" 
                    color="rgb(255, 78, 78)" outline
                    :disabled="loading"
                    @click.native="dispatcher(detailOfferData.offerId, detailOfferData.offerLabel, detailOfferData.categoryInternalName, 'disable', 'normal')">
                    <template v-if="!loading">
                      Disable offer
                    </template>
                    <template v-else>
                      <div class="text-xs-center">
                        <v-progress-circular
                          :size="20" :width="3"
                          color="rgb(192, 192, 192)"
                          indeterminate></v-progress-circular>
                      </div>
                    </template>
                  </v-btn>
                </template>
              </template>
            </template>
          </div>
        </div>
      </v-card>
    </v-dialog>
    
    <!-- Detailed offer view ends -->

    <!-- New offer  -------------------------------------------------------------------------------------------------------->
    <v-dialog v-model="newOfferDialog" 
              persistent
              width="1200px" height="830px">
      <v-card width="1200px" height="830px" class="display-flex new-offer-dialog">
        <v-stepper v-model="currentStep">
          <v-stepper-header>
            <v-stepper-step :complete="currentStep > 1" step="1"></v-stepper-step>
            <v-divider></v-divider>
            <v-stepper-step :complete="currentStep > 2" step="2"></v-stepper-step>
            <v-divider></v-divider>
            <v-stepper-step :complete="currentStep > 3" step="3"></v-stepper-step>
            <v-divider></v-divider>
            <v-stepper-step step="4"></v-stepper-step>
          </v-stepper-header>
          <v-stepper-items>
            <v-stepper-content step="1">
              <div class="container">
                <p class="dialog-title" style="display: block">Create offer</p>
                <v-radio-group v-model="newOffer.offerType" class="radio-group">
                  <v-radio v-for="(offerType, i) in offerTypes" 
                            :key="i"
                            color="#3A9EF0"
                            class="default-radio big-radio" :class="{ active: newOffer.offerType == offerType.label }"
                            :label="offerType.label"
                            :value="offerType.label"
                            :disabled="!offerType.available"
                            @click.native="newOffer.offerType = offerType.label"/>
                </v-radio-group>
              </div>
              <div class="bottom-actions">
                <v-btn class="base-button" 
                      color="#6DC570"
                      @click="currentStep = 2"
                      :disabled="newOffer.offerType == '' || newOffer.offerType == undefined || newOffer.offerType == null"
                      flat outline style="width: 200px;">
                  Select
                </v-btn>
                <v-btn class="base-button" 
                        color="rgb(192, 192, 192)"
                        @click="closeNewOffer()"
                        flat outline width="20px">
                  CLOSE
                </v-btn>
              </div>
            </v-stepper-content>
            <v-stepper-content step="2">
              <div class="container">
                <p class="dialog-title" style="display: block">Select country and category</p>
                <div class="display-flex divide-half" style="height: 400px; align-content: center; padding-top: 240px;">
                  <v-container class="dropdownContainerForm" style="margin-right: auto; margin-left: auto; display: block; width: 350px">
                    <v-select :items="filters.countries"
                              v-model="newOffer.country"
                              label="Country *"
                              item-text="marketLabel"
                              item-value="marketCountryCode"
                              dense single-line solo flat 
                              class="basicDropdownForm"
                              :menu-props="{contentClass:'basicDropdownContent'}">
                      <template slot="selection" slot-scope="data">
                        {{ data.item.marketLabel | maxLength(30) }}
                      </template>
                    </v-select>
                  </v-container>
                </div>
                <div class="display-flex divide-half" style="height: 400px; align-content: center; padding-top: 240px;">
                  <v-container class="dropdownContainerForm" style="margin-right: auto; margin-left: auto; display: block; width: 350px">
                    <v-select :items="staticFilters.categories"
                              v-model="newOffer.category"
                              label="Category *"
                              item-text="categoryLabel"
                              item-value="categoryRef"
                              title="categoryLabel"
                              dense single-line solo flat
                              class="basicDropdownForm"
                              :menu-props="{contentClass:'basicDropdownContent'}">
                      <template slot="selection" slot-scope="data">
                        {{ data.item.categoryLabel | maxLength(30) }}
                      </template>
                    </v-select>
                  </v-container>
                </div>
              </div>
              <div class="bottom-actions">
                  <v-btn class="base-button" 
                        color="#6DC570"
                        @click="loadActiveOffers()"
                        :disabled="newOffer.country == '' || newOffer.country == undefined || newOffer.country == null || loading == true || 
                          newOffer.category == '' || newOffer.category == undefined || newOffer.category == null" 
                        flat outline style="width: 200px;">
                    <template v-if="!loading">
                      Select
                    </template>
                    <template v-else>
                      <div class="text-xs-center">
                        <v-progress-circular
                          :size="20" :width="3"
                          color="rgb(192, 192, 192)"
                          indeterminate></v-progress-circular>
                      </div>
                    </template>
                  </v-btn>
                  <v-btn class="base-button" 
                          color="rgb(192, 192, 192)"
                          @click="currentStep = 1"
                          flat outline width="20px">
                    <v-icon>arrow_back_ios</v-icon>
                  </v-btn>
                </div>
            </v-stepper-content>
            <v-stepper-content step="3">
              <template v-if='!newOffer.offersToChosebetween.length || newOffer.offersToChosebetween.length &lt; 2'>
                <div class="container">
                  <p class="dialog-title" style="display: block">Choose an offer to be disabled</p>
                  <p>You can proceed! Your market doesn't have 3 default fallback offers yet, so you can create a new one without disabling any of the existing ones.</p>
                  <v-icon style="display: inline-block; margin-right: auto; margin-left: auto; margin-top: 154px;
                    font-size: 140px; width: 100%; color: rgb(109, 197, 112); text-align: center;">
                    check_circle_outline
                  </v-icon>
                </div>
                <div class="bottom-actions">
                  <v-btn class="base-button" 
                        color="#6DC570"
                        @click="currentStep = 4"
                        :disabled="loading == true" 
                        flat outline style="width: 200px;">
                    <template v-if="!loading">
                      Proceed
                    </template>
                    <template v-else>
                      <div class="text-xs-center">
                        <v-progress-circular
                          :size="20" :width="3"
                          color="rgb(192, 192, 192)"
                          indeterminate></v-progress-circular>
                      </div>
                    </template>
                  </v-btn>
                  <v-btn class="base-button" 
                          color="rgb(192, 192, 192)"
                          @click="currentStep = 2"
                          flat outline width="20px">
                    <v-icon>arrow_back_ios</v-icon>
                  </v-btn>
                </div>
              </template>
              <template v-else>
                <div class="container">
                  <p class="dialog-title" style="display: block">Choose an offer to be disabled</p>
                  <p>In order to be able to create a new Default fallback offer, you first have to disable one of the currrently live ones.</p>
                  <p style="margin-bottom: 50px">Note that the selected offer will only be disabled after you have created a new offer by completing the step 4.</p>
                  <div style="position: relative; display: inline-block" v-for="(offer,i) in newOffer.offersToChosebetween" :key="i" class="content-wrapper">
                    <template v-if="newOffer.selectedOfferToDisable != '' && newOffer.selectedOfferToDisable != null && newOffer.selectedOfferToDisable != undefined">
                      <v-icon v-if="newOffer.selectedOfferToDisable.offerId == offer.offerId" class="disable-badge">backspace</v-icon>
                    </template>
                    <v-hover>
                      <v-card class="baseCard clickable align-top special" 
                              align="top"
                              slot-scope="{ hover }"
                              :class="`elevation-${hover ? 12 : 2}`"
                              @click="newOffer.selectedOfferToDisable = offer">
                        <v-card-title primary-title class="card-title" >
                          <div class="status-container" :class="{greenBackground: offer.statusLive == 6, redBackground: offer.statusLive != 6}"></div>
                          <h3 class="headline" :title="offer.offerLabel">{{ offer.offerLabel | maxLength(30) }} </h3>
                          <v-card-text>
                            <p class="offer-category">{{ offer.categoryInternalName | makeIntoCategory }}</p>
                            <div><b>SL 1:</b>
                              {{offer.subject1}}</div>
                          <div><b>SL 2:</b>
                              {{offer.subject2}}</div>
                          <div><b>Pre Header:</b>
                            {{offer.preheader}}</div>
                          </v-card-text>
                        
                        </v-card-title>
                        <div v-if="offer.imageDesktopURL" style="position: relative; width: 100%;">
                          <v-img :src="'http://'+offer.imageDesktopURL" 
                                aspect-ratio="2">
                            <template v-slot:placeholder>
                                <v-layout fill-height
                                  align-center
                                  justify-center
                                  ma-0>
                                  <v-progress-circular indeterminate color="grey"></v-progress-circular>
                              </v-layout>
                            </template>
                          </v-img>
                        </div>
                        <v-card-title class="text-center center">
                          <div v-if="offer.headline" class="margin-auto offer-content" style="font-family:Verdana; font-weight:bold; mso-line-height-rule:exactly; line-height:22px !important; font-size:21px; color:#ff5a00; padding:0 0 8px 0;">{{offer.headline}}</div>
                          <div v-if="offer.copyText" class="offer-content" style="padding: 0 0 16px 0">{{offer.copyText}}</div>
                          <div v-if="offer.CTAtext" style="margin: auto; padding:6px 14px; -webkit-border-radius:4px; border-radius:4px; font-size:14px; font-family:Verdana; color:#ffffff; display:inline-block; border:1px solid #ff5a00; background-color: #ff5a00;">
                            <span style="font-size:14px; font-family:Verdana; text-decoration:none; font-weight:bold; mso-line-height-rule:exactly; 
                              line-height:14px !important; color:#ffffff;" target="_blank">{{offer.CTAtext}}</span>
                          </div>
                        </v-card-title>
                      </v-card>
                    </v-hover>
                  </div>
                </div>
                <div class="bottom-actions">
                  <v-btn class="base-button" 
                        color="#6DC570"
                        @click="currentStep = 4"
                        :disabled="newOffer.selectedOfferToDisable == '' || newOffer.selectedOfferToDisable == undefined || 
                          newOffer.selectedOfferToDisable == null || loading == true" 
                        flat outline style="width: 200px;">
                    <template v-if="!loading">
                      Select
                    </template>
                    <template v-else>
                      <div class="text-xs-center">
                        <v-progress-circular
                          :size="20" :width="3"
                          color="rgb(192, 192, 192)"
                          indeterminate></v-progress-circular>
                      </div>
                    </template>
                  </v-btn>
                  <v-btn class="base-button" 
                          color="rgb(192, 192, 192)"
                          @click="currentStep = 2"
                          flat outline width="20px">
                    <v-icon>arrow_back_ios</v-icon>
                  </v-btn>
                </div>
              </template>
              
            </v-stepper-content>
            <v-stepper-content step="4">
              <div class="leftSide align-top">
                <div class="spacer-big"></div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.preHeader"
                                label="Pre Header"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.subjectOne"
                                label="Subject line 1 *"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.subjectTwo"
                                label="Subject line 2"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="spacer-big"></div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.headline"
                                label="Headline *"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.subheadline"
                                label="Subheadline"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="spacer-big"></div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.imageURL"
                                label="Image URL beginning with 'https://' *"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.mobileImageURL"
                                label="Mobile Image URL beginning with 'https://'"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.imageAltText"
                                label="Image Alt Text"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="spacer-big"></div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.copyText"
                                label="Copy Text"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.CTAText"
                                label="CTA Text"
                                class="basicInput">
                  </v-text-field>
                </div>
                <div class="basicInputContainer special full-width">
                  <v-text-field v-model="newOffer.destinationURL"
                                label="Destination URL beginning with 'https://'"
                                class="basicInput">
                  </v-text-field>
                </div>
              </div>
              <div class="rightSide align-top">
                <div class="spacer"></div>
                <p class="dialog-title full-width center-text">Offer preview - {{ newOffer.blockName }}</p>
                <div class="previewContainer">
                  <div class="previewContainer-content">
                    <!-- Desktop preview - Main 1 column -->
                    <table width="100%" cellpadding="0" cellspacing="0" bgcolor="#ffffff">
                      <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit; border-collapse: collapse">
                        <tr style="display: table-row; vertical-align: inherit; border-color: inherit;">
                          <td align="center" valign="top" style="border-collapse: collapse">
                            <table cellpadding="0" cellspacing="0" bgcolor="#ffffff" style="width:600px; border-collapse: collapse;">
                              <tbody style="display: table-row-group; vertical-align: middle; ">
                                <tr style="display: table-row; vertical-align: inherit;">
                                  <td align="left" valign="top" style="border-collapse: collapse">
                                    <table style="border:0; width:100%">
                                      <tbody style="display: table-row-group">
                                        <tr style="display: table-row;">
                                          <td style="padding:0 10px 16px 10px">
                                            <a :href="newOffer.destinationURL" target="_blank">
                                              <template>
                                              <img v-if="newOffer.imageURL && newOffer.imageURL != '' && newOffer.imageURL != undefined && newOffer.imageURL != null"
                                                :src="newOffer.imageURL" :alt="newOffer.imageAltText" style="display:block; width: 580px;"/>
                                              </template>
                                            </a>
                                          </td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </td>
                                </tr>
                                <tr style="display: table-row;">
                                  <td dir="ltr" valign="top" style="padding:0 20px 0 20px; border-collapse: collapse">
                                    <table border="0" width="100%" cellpadding="0" cellspacing="0">
                                      <tbody style="display: table-row-group; vertical-align: middle; border-color: inherit;">
                                        <tr v-if="newOffer.headline && newOffer.headline != '' && newOffer.headline != undefined && newOffer.headline != null"
                                          style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                          <td align="left" valign="top" style="font-family:Verdana; font-weight:bold; font-size:21px; color:#ff5a00; padding:0 0 8px 0;">
                                            {{ newOffer.headline }}
                                          </td>
                                        </tr>
                                        <tr v-if="newOffer.subheadline && newOffer.subheadline != '' && newOffer.subheadline != undefined && newOffer.subheadline != null"
                                          style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                          <td align="left" valign="top" style="font-family:Verdana; font-weight:bold; font-size:16px; color:#b6b6b6; padding:0 0 8px 0;">
                                            {{ newOffer.subheadline }}
                                          </td>
                                        </tr>
                                        <tr v-if="newOffer.copyText && newOffer.copyText != '' && newOffer.copyText != undefined && newOffer.copyText != null"
                                            style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                          <td align="left" valign="top" style="font-family:Verdana; line-height:17px; font-size:13px; color:#000000; padding:0 0 16px 0;">
                                            {{ newOffer.copyText }}
                                          </td>
                                        </tr>
                                        <tr v-if="newOffer.CTAText && newOffer.CTAText != '' && newOffer.CTAText != undefined && newOffer.CTAText != null"
                                            style="display: table-row; vertical-align: inherit; border-color: inherit;">
                                          <td align="center" style="padding:0 0 0 0; border-collapse: collapse">
                                            <table style="border-collapse: collapse">
                                              <tbody>
                                                <tr>
                                                  <th bgcolor="#ff5a00" style="padding:6px 14px; -webkit-border-radius:4px; border-radius:4px; font-size:14px; 
                                                      font-family:Verdana; color:#ffffff; display:inline-block; border:1px solid #ff5a00;">
                                                    <a :href="newOffer.destinationURL" style="font-size:14px; font-family:Verdana;line-height:14px; 
                                                        text-decoration:none; font-weight:bold; mso-line-height-rule:exactly; color:#ffffff;" target="_blank"> 
                                                      {{ newOffer.CTAText }}
                                                    </a>  
                                                  </th>
                                                </tr>
                                              </tbody>
                                            </table>
                                          </td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <!-- Desktop preview - Main 1 column ends -->
                  </div>
                </div>
                <v-flex>
                  <div class="view-actions">
                    <v-tooltip top open-delay="300">
                      <template v-slot:activator="{ on }">
                        <div class="icon-container" :class="{ active: newOffer.block == 'mainOneColumn' }" 
                          @click="newOffer.block = 'mainOneColumn', newOffer.blockName = 'Main One Column'" v-on="on">
                          <v-icon color="white" 
                                  class="icon" 
                                  :class="{ active: newOffer.block == 'mainOneColumn' }">
                                  filter_1
                          </v-icon> 
                        </div>
                      </template>
                      <span>Main column 1</span>
                    </v-tooltip>
                    <div class="icon-divider"></div>
                    <v-tooltip top open-delay="300">
                      <template v-slot:activator="{ on }">
                        <div class="icon-container" :class="{ active: newOffer.block == 'mainTwoColumn' }" 
                          @click="newOffer.block = 'mainTwoColumn', newOffer.blockName = 'Main Two Column'" v-on="on">
                          <v-icon color="white" 
                                  class="icon" 
                                  :class="{ active: newOffer.block == 'mainTwoColumn' }">
                                  filter_2
                          </v-icon> 
                        </div>
                      </template>
                      <span>Main column 2</span>
                    </v-tooltip>
                    <div class="icon-divider"></div>
                    <v-tooltip top open-delay="300">
                      <template v-slot:activator="{ on }">
                        <div class="icon-container" :class="{ active: newOffer.block == 'ecommerce' }" 
                          @click="newOffer.block = 'ecommerce', newOffer.blockName = 'Ecommerce block'" v-on="on">
                          <v-icon color="white" 
                                  class="icon" 
                                  :class="{ active: newOffer.block == 'ecommerce' }">
                                  view_week
                          </v-icon> 
                        </div>
                      </template>
                      <span>Ecommerce block</span>
                    </v-tooltip>
                    <div class="icon-divider"></div>
                    <v-tooltip top open-delay="300">
                      <template v-slot:activator="{ on }">
                        <div class="icon-container" :class="{ active: newOffer.block == 'split' }" 
                          @click="newOffer.block = 'split', newOffer.blockName = '50/50 Split'" v-on="on">
                          <v-icon color="white" 
                                  class="icon rotateIcon" 
                                  :class="{ active: newOffer.block == 'split' }">
                                  view_agenda
                          </v-icon> 
                        </div>
                      </template>
                      <span>Split 50/50</span>
                    </v-tooltip>
                  </div>
                </v-flex>
                <v-btn class="base-button" 
                        color="rgb(192, 192, 192)"
                        @click="currentStep = 3"
                        flat outline width="20px" style="display: inline-block; margin-right: 10px; margin-top: 20px; margin-left: 0px;">
                  <v-icon>arrow_back_ios</v-icon>
                </v-btn>
                <template v-if="!isNewOfferFormValid">
                  <v-btn class="base-button" style="margin-top: 20px; margin-left: 0px; width: 653px; width: 540px; margin-right: 0px;"
                    disabled outline color="#6DC570">
                    Create offer
                  </v-btn>
                  <p class="hint" style="margin-top: 10px;">* You need to fill out all the fields with a star</p>
                </template>
                <template v-else>
                  <v-btn class="base-button" style="margin-top: 20px; margin-left: 0px; width: 653px; width: 540px; margin-right: 0px;"
                    outline color="#6DC570" @click="createNewOffer()">
                    <template v-if="!loading">
                      Create offer
                    </template>
                    <template v-else>
                      <div class="text-xs-center">
                        <v-progress-circular
                          :size="20" :width="3"
                          color="rgb(192, 192, 192)"
                          indeterminate></v-progress-circular>
                      </div>
                    </template>
                  </v-btn>
                </template>
              </div>
            </v-stepper-content>
          </v-stepper-items>
      </v-card>
    </v-dialog>
    <!-- New offer ends -->

    <div class="base-alert-container">
      <template v-for="(alert, i) in alerts">
        <template v-if="alert.type == 'error'">
          <v-alert class="base-alert" :value="alert.show" :key="i"
                    type="error" dismissible
                    transition="slide-y-transition">
            {{ alert.message }}
          </v-alert>
        </template>
        <template v-if="alert.type == 'success'">
          <v-alert class="base-alert" :value="alert.show" :key="i"
                    type="success" dismissible
                    transition="slide-y-transition">
            {{ alert.message }}
          </v-alert>
        </template>
      </template>
    </div>

    <!-- Content ends -->

    <!-- Footer -------------------------------------------------------------------------------------------------------->
    <v-footer dark
              height="auto"
              class="footer">
      <v-card flat
              tile
              class="white--text text-xs-center footer-card">
        <v-card-text>
          <template v-for="icon in footerIcons">
            <p class="inline-block footer-icon-text">{{ icon.description }}</p>
            <v-btn  :key="icon.name"
                    class="mx-1 white--text"
                    icon>
              <v-icon size="24px">
                {{ icon.name }}
              </v-icon>
            </v-btn>
          </template>
          
        </v-card-text>
        <v-divider style="margin: 0;"></v-divider>
        <v-card-text class="white--text">
          <br>
          A member of WPP Group. &copy; 2019  <strong>Wunderman</strong>
          <br>
          All Rights Reserved.
          <br><br>
        </v-card-text>
      </v-card>
    </v-footer>
    <!-- Footer ends -->
  </v-app>
  <!-- vue.js functionalities -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <!-- bootstrap -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script>
    var vm = new Vue({
      el: '#app',

      filters: {
        maxLength: function(value, desiredLength) {
          if (!value) return '';
          value = value.toString();
          desiredLength = desiredLength*1;
          if(value.length > desiredLength) {
            //console.log('we here')
            return value.substring(0, desiredLength) + '...';
          } else {
            //console.log('we actually here '+ value.length +' '+ desiredLength)
            return value;
          }
        },

        formatDate: function(value, desiredFormat) {
          console.log('we are trying to change: '+value+' into: '+desiredFormat);
          return moment(value).format(desiredFormat);
        },
        
        makeIntoCategory: function(value) {
          let mainCtegory = '';
          let subCategory = '';

          for(var j = 0; j < vm.staticFilters.categories.length; j++) {
            let substring = vm.staticFilters.categories[j].categoryRef;
            //console.log('substring: '+ vm.staticFilters.categories[j].categoryRef +' full thing: ' + value+ ' iterations: '+vm.staticFilters.categories.length)
            if(value.includes(substring)) {
              //console.log(value + ' contains '+ substring);
              if(mainCtegory == '') {
                mainCtegory = vm.staticFilters.categories[j].categoryLabel;
              }else{
                subCategory = vm.staticFilters.categories[j].categoryLabel;
              }
            }
          }
          if(subCategory == ''){
            return mainCtegory;
          }else{
            return mainCtegory+' - '+subCategory;
          }
        }
      },

      props: {
        offers: Array,
        filters: Object,
      },

      data: {
        alerts: [],
        newOfferDialog: false,
        isLoadingOffers: false,
        isLoadingMoreOffers: false,
        loading: false,
        detailOfferView: false,
        detailOfferData: {},
        detailOfferBlock: 'mainOneColumn',
        detailOfferBlockName: 'Main One Column',
        queryStartLine: 0,
        filtersSelected: {
          mco: '',
          umbrella: '',
          country: '',
          category: '',
          status: '',
          default: false,
          label: '',
          lineCount: 12
        },
        eligibleSubstrings: ['_rcr', '_dps', '_ws', '_dpr', '_ret', '_arc', '_rcrv02', '_rcrv03', '_ups'],
        newOffer: {
          typeToCreate: 'default_fallback',
          block: 'mainOneColumn',
          blockName: 'Main One Column',
          offerType: '',
          country: '',
          category: '',
          language: '',
          preHeader: '',
          subjectOne: '',
          subjectTwo: '',
          headline: '',
          subheadline: '',
          imageURL: '',
          mobileImageURL: '',
          imageAltText: '',
          copyText: '',
          CTAText: '',
          destinationURL: '',
          offersToChosebetween: [],
          selectedOfferToDisable: '',
        },
        offerTypes: [
          { label: 'Default', available: false },
          { label: 'Default fallback', available: true },
          { label: 'Recommended', available: false },
          { label: 'Segmented', available: false }
        ],
        isNewOfferFormValid: false,
        currentStep: 0,
        sidebar: false,
        subPages: [
          {
            id: 1,
            name: 'Proofing dashboard',
            link: 'file:///C:/Users/antala/Documents/bc_peoject/bc_project/bc_project/campaign-dashboard.html',
            icon: 'list'
          },
          {
            id: 2,
            name: 'Offer dashboard',
            link: 'file:///C:/Users/antala/Documents/bc_peoject/bc_project/bc_project/index.html',
            icon: 'extension'
          },
          {
            id: 4,
            name: 'FAQ',
            link: 'xyz',
            icon: 'help_outline'
          }
        ],
        socialIcons: [
          {
            name: 'tumblr',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/64a84557abe8e5b85db5872cd3f97b20.png"
          },
          {
            name: 'twitter',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/29ff2cc1aaf55cdd7d4d5048831d9ced.png"
          },
          {
            name: 'youtube',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/9f26d4ccd5ef9a6eb1b13ddaaac55069.png"
          },
          {
            name: 'whatsApp',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/96e103e615a88f2f7146aa1b6a29b348.png"
          },
          {
            name: 'facebook',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/ca3264cfa0247c069c8a311056f16c79.png"
          },
          {
            name: 'google',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/e84e8b411d47b36257d0cae80bf90b3e.png"
          },
          {
            name: 'instagram',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/f74da9663a397434375dcea5ad26c2c6.png"
          }
          
        ],
        footerIcons: [
          {
            name: 'email',
            description: 'Email us:'
          },
          {
            name: 'call',
            description: 'Call us:'
          }
        ],
        staticFilters: {
          categories: [
            {
              categoryLabel: 'Recipe Recommendation',
              categoryRef: '_rcr'
            },
            {
              categoryLabel: 'Whitespot - Product',
              categoryRef: '_ws'
            },
            {
              categoryLabel: 'Deepsell',
              categoryRef: '_dps'
            },
            {
              categoryLabel: 'Digital Product Recommendation - Sample',
              categoryRef: '_dpr'
            },
            {
              categoryLabel: 'Hero Articles',
              categoryRef: '_ha'
            },
            {
              categoryLabel: 'Promotion and Activation',
              categoryRef: '_ha_proAct'
            },
            {
              categoryLabel: 'Inspiration',
              categoryRef: '_ha_inspr'
            },
            {
              categoryLabel: 'Secondary Articles',
              categoryRef: '_sa'
            },
            {
              categoryLabel: 'Competitions and Events',
              categoryRef: '_ce'
            },
            {
              categoryLabel: 'Competitions',
              categoryRef: '_ce_com'
            },
            {
              categoryLabel: 'Events',
              categoryRef: '_ce_event'
            },
            {
              categoryLabel: 'Chef Rewards',
              categoryRef: '_cr'
            },
            {
              categoryLabel: 'Chef Rewards Members',
              categoryRef: '_cr_crM'
            },{
              categoryLabel: 'Chef Rewards Non-Members',
              categoryRef: 'cr_crNonM'
            },{
              categoryLabel: 'Retention - Product',
              categoryRef: '_ret'
            },{
              categoryLabel: 'Article - Product',
              categoryRef: '_arc'
            },{
              categoryLabel: 'Recipe Recommendation V02',
              categoryRef: '_rcrv02'
            },{
              categoryLabel: 'Recipe Recommendation V03',
              categoryRef: '_rcrv03'
            },{
              categoryLabel: 'Upsell - Product',
              categoryRef: '_ups'
            },{
              categoryLabel: 'Default',
              categoryRef: 'Default'
            }
          ],
          status: [
            {
              name: 'Live'
            },
            {
              name: 'Disabled'
            }
          ]
        },
        sendingProof: false,
        proofEmailAddress: '',
        noMoreOffersToLoad: false,
      },
      
      watch: {
        // 'filtersSelected': {
        //   handler(val, previous) {
        //     console.log(JSON.stringify(val)+' ... '+JSON.stringify(previous))
        //     let caller = "filtering";
        //     //console.log('we are trying to debounce');
        //     this.filtersUpdated;
        //   },
        //   deep: true
        // },
        'newOffer': {
          handler(val) {
            this.validateForm();
          },
          deep: true
        },

      },

      created() {
        this.loadFilters();
      },

      mounted() {
        this.$watch('filtersSelected.country', this.filtersUpdated);
        this.$watch('filtersSelected.category', this.filtersUpdated);
        this.$watch('filtersSelected.status', this.filtersUpdated);
        this.$watch('filtersSelected.label', this.filtersUpdated);
        this.$watch('filtersSelected.default', this.filtersUpdated);
        let startPayload = {
          mco: '',
          umbrella: '',
          country: '',
          category: '',
          status: '',
          default: false,
          lineCount: 12,
          label: ''
        };

        this.loadOffers(startPayload, 'filtering');
        console.log('we are trying to make it visible ');
        document.getElementById('mother-loader').style.visibility = "visible";
      },

      methods: {
        filtersUpdated: _.debounce(function (e) {
          this.loadOffers(vm.filtersSelected, 'filtering');
        }, 500),

        loadActiveOffers() {
          let payload = {
            mco: '',
            umbrella: '',
            country: this.newOffer.country,
            category: this.newOffer.category,
            status: 6,
            lineCount: 3,
            label: 'Default_Fallback'
          };
          this.loadOffers(payload, 'getting active')
        },

        loadOffers(payload, caller) {
          if(caller == 'filtering' ) {
            this.isLoadingOffers = true;
          }else if(caller == 'getting active') {
            this.loading = true;
          }
          
          let baseUrl = 'https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardGetOffers.jssp';
          let hasUrlBeenAddedTo = false;
          
          //console.log(payload)
          //console.log(caller)
          if(payload.mco != '' && payload.mco != undefined && payload.mco != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?MCO='+payload.mco;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&MCO='+payload.mco;
            }
          }
          if(payload.umbrella != '' && payload.umbrella != undefined && payload.umbrella != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?umbrella='+payload.umbrella;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&umbrella='+payload.umbrella;
            }
          }
          if(payload.country != '' && payload.country != undefined && payload.country != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?country='+payload.country;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&country='+payload.country;
            }
          }
          if(payload.category != '' && payload.category != undefined && payload.category != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?category='+payload.category;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&category='+payload.category;
            }
          }
          if(payload.status != '' && payload.status != undefined && payload.status != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?status='+payload.status;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&status='+payload.status;
            }
          }
          if(payload.lineCount != '' && payload.lineCount != undefined && payload.lineCount != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?lineCount='+payload.lineCount;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&lineCount='+payload.lineCount;
            }
          }
          if(payload.label != '' && payload.label != undefined && payload.label != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?label='+payload.label;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&label='+payload.label;
            }
          }
          if(payload.default != '' && payload.default != undefined && payload.default != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?default='+payload.default;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&default='+payload.default;
            }
          }
          
          if(caller == "loadingMoreOffers"){
            console.log('we loading more offers')
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?startLine='+vm.queryStartLine;
              hasUrlBeenAddedTo = true;

              console.log(baseUrl)
              axios.get(baseUrl).then(function(offerData){
                if(!offerData.data.length) {
                  vm.noMoreOffersToLoad = true;
                }
                vm.offers = vm.offers.concat(offerData.data)
                vm.isLoadingMoreOffers = false;
              })
            }else{
              baseUrl = baseUrl+'&startLine='+vm.queryStartLine;

              console.log(baseUrl)
              axios.get(baseUrl).then(function(offerData){
                if(!offerData.data.length) {
                  vm.noMoreOffersToLoad = true;
                }
                vm.offers = vm.offers.concat(offerData.data)
                vm.isLoadingMoreOffers = false;
              })
            }
          }else if(caller == "filtering"){
            console.log(this.queryStartLine)
            this.queryStartLine = 0;

            console.log(baseUrl)
            axios.get(baseUrl).then(function(offerData){
              vm.offers = offerData.data;
              console.log(offerData.data);
              vm.isLoadingOffers = false;
            })
          }else if(caller == 'getting active') {
            console.log(baseUrl)
            axios.get(baseUrl).then(function(offerData){
              console.log(offerData.data);
              vm.newOffer.offersToChosebetween = offerData.data;
              vm.loading = false;
              vm.currentStep = 3;
            })
          }
        },

        sendTheOfferProof() {
          if(this.sendingProof == true) {
            console.log('we here sending shit to:' + vm.proofEmailAddress);

            axios.post('https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardSendProof.jssp', 
            { email: this.proofEmailAddress, 
              offerLabel: vm.detailOfferData.offerLabel,
              categoryInternalName : vm.detailOfferData.categoryInternalName})
            .then(function(response) {
              console.log(response)
              vm.sendingProof = false;
              vm.proofEmailAddress = '';
              vm.alerts.push({
                type: 'success',
                message: "Bullseye! Your proof was sent.",
                show: true,
              });
            })
            .catch(function (error) {
              console.log("error")
              console.log(response)
              vm.sendingProof = false;
              vm.proofEmailAddress = '';
              vm.alerts.push({
                type: 'error',
                message: "Oopsie. Unfortunately, we couldn't send your proof. Please, reload the page and try again.",
                show: true,
              });
            })

          }
        },

        loadMoreOffers() {
          this.isLoadingMoreOffers = true;
          let caller = "loadingMoreOffers";  
          vm.queryStartLine += 12;
          vm.loadOffers(vm.filtersSelected, caller);
        },

        loadFilters() {
          axios.get('https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardGetFilters.jssp').then(function(filterData){
          vm.filters = filterData.data;
          console.log(filterData.data);
          })
        },

        openDetailView(dataForOffer) {
          vm.detailOfferData = dataForOffer;
          vm.detailOfferView = true;
        },

        closeDetailView() {
          vm.detailOfferView = false;
          vm.detailOfferData = {};
          vm.proofEmailAddress = '';
          vm.sendingProof = false;
        },

        openNewOfferDialog() {
          vm.newOfferDialog = true;
        },

        validateForm() {
          for (var key in vm.newOffer) {
            if(vm.newOffer[key].length < 1){
              if(key == 'offerType' || key == 'country' || key == 'category' || key == 'subjectOne' || key == 'offerLabel' || key == 'headline' || key == 'imageURL') {
                vm.isNewOfferFormValid = false;
                //console.log(key +' is empty and equals to: '+vm.newOffer[key])
                return;
              }else{

              }
            }
          }
          vm.isNewOfferFormValid = true;
        },

        createNewOffer() {
          this.loading = true;
          let payload = vm.newOffer;
          console.log("creating a new offer");
          axios.post('https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardCreateOffer.jssp', payload)
          .then(function(response) {
            console.log(response)
            vm.alerts.push({
              type: 'success',
              message: "Bullseye! New offer created.",
              show: true,
            });
            vm.newOfferDialog = false;
            vm.loading = false; 
            vm.filtersSelected.label = {
              mco: '',
              umbrella: '',
              country: '',
              category: '',
              status: '',
              default: false,
              label: this.newOffer.offerLabel,
              lineCount: 12,
            };
            vm.newOffer = {
              block: 'mainOneColumn',
              blockName: 'Main One Column',
              offerType: '',
              country: '',
              category: '',
              offerLabel: '',
              preHeader: '',
              subjectOne: '',
              subjectTwo: '',
              headline: '',
              subheadline: '',
              imageURL: '',
              mobileImageURL: '',
              imageAltText: '',
              copyText: '',
              CTAText: '',
              destinationURL: '',
              offersToChosebetween: [],
              selectedOfferToDisable: '',
            };
          })
          .catch(function (error) {
            console.log("error:");
            console.log(response);
            vm.alerts.push({
              type: 'error',
              message: "Oopsie! We disabled the selected offer, but we coudln't create your new offer. Please, reload the page and try again.",
              show: true,
            });
            vm.loading = false;
          }).finally(function() {
            this.currentStep = 1;
          })
        },

        doesStringContain(stringToCompare, arrayOfSubstrings) {
          //console.log('we are checking for '+ arrayOfSubstrings +' substring in' + stringToCompare);
          for(var i = 0; i < arrayOfSubstrings.length; i++) {
            let substring = arrayOfSubstrings[i];
            if(stringToCompare.includes(substring)) {
              console.log(stringToCompare + ' contains '+ substring);
              return true;
            }
          }
          return false;
        },

        disableSelectedFOffer() {
          vm.loading = true;
          let offerID = this.newOffer.selectedOfferToDisable.offerId;
          let offerLabel = this.newOffer.selectedOfferToDisable.offerLabel;
          let categoryInternalName = this.newOffer.selectedOfferToDisable.categoryInternalName;
          let action = 'disable';
          let situation = 'disabling to create';
          vm.dispatcher(offerID, offerLabel, categoryInternalName, action, situation);
        },

        dispatcher(offerId, offerLabel, categoryInternalName, action, situation) {
          vm.loading = true;
          console.log("dispatcher called. offerID:"+offerId+' offerLabel: '+offerLabel+' catInternalName: '+ categoryInternalName+' action: '+action+' situation: '+situation);
          axios.post('https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardDispatcher.jssp', {offerId: offerId, offerLabel : offerLabel, categoryInternalName: categoryInternalName, action : action})
          .then(function(response) {
            console.log('This is the response: '+response)
            setTimeout(function(){
              if(situation == 'disabling to create'){
                vm.alerts.push({
                  type: 'success',
                  message: 'Selected offer disdabled successfully!',
                  show: true,
                });
                vm.createNewOffer();
              }else {
                vm.loading = false;
                vm.alerts.push({
                  type: 'success',
                  message: 'Done and done!',
                  show: true,
                });
                vm.filtersSelected = {
                  mco: '',
                  umbrella: '',
                  country: '',
                  category: '',
                  status: '',
                  default: false,
                  label: response.data,
                  lineCount: 12
                };
                vm.detailOfferView = false;
                vm.detailOfferData = {};
              }
            }, 5000)
          })
          .catch(function (error) {
            console.log("error: ")
            console.log(JSON.stringify(response))
            vm.loading = false;
            vm.alerts.push({
              type: 'error',
              message: "Oopsie. Unfortunately, we couldn't disable the selected offer. Please, reload the page and try again.",
              show: true,
            });
          })
        },

        logout() {
          console.log("logout clicked")
        },

        closeNewOffer() {
          this.newOfferDialog = false;
          this.newOffer = {
            block: 'mainOneColumn',
            blockName: 'Main One Column',
            offerType: '',
            country: '',
            category: '',
            preHeader: '',
            subjectOne: '',
            subjectTwo: '',
            headline: '',
            subheadline: '',
            imageURL: '',
            mobileImageURL: '',
            imageAltText: '',
            copyText: '',
            CTAText: '',
            destinationURL: '',
            offersToChosebetween: [],
            selectedOfferToDisable: '',
          }
        },


      }
    })
  </script>
</body>

</html>
