<% /*Add this to engage logon requirement */ %>
<%@ page import="xtk:shared/nl.js" %>
<% NL.require('xtk:jsspcontext.js'); %>
<%
  if( !(new NL.JSSPContext(request)).checkAuthentication(response) )
    return;
%>

<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
  <!-- below is FONT -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet">
  <!-- below is vuetify -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
  <!-- below is vue functionalities -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
  <!-- AXIOS -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <!-- below is material icons -->
  <link rel="icon" sizes="192x192" href="https://material.io/static/images/simple-lp/favicons/components-192x192.png">
  <link rel="shortcut icon" href="https://material.io/static/images/simple-lp/favicons/components-72x72.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/6.0.0/normalize.min.css">
  <!-- below is bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- below css is temporary 
  <link rel="stylesheet" type="text/css" href="css/style.css">-->
  <style>
/* sass --watch style.scss style.css */
* {
  position: relative;
}
*::-webkit-scrollbar {
  background-color: rgba(255, 255, 255, 0);
  width: 3px;
}
*::-webkit-scrollbar-thumb {
  background-color: #3A9EF0;
  width: 3px;
}

/* INDEX ------------------------------------------------------------------------- INDEX */
.navLogo {
  height: 50px;
}

.sidebar-tile {
  border-top: rgba(0, 0, 0, 0.03) 1px solid;
}

.sidebar-tile:last-child {
  border-bottom: rgba(0, 0, 0, 0.03) 1px solid;
}

.sidebar-tile a {
  height: 90px;
}

.action-margin-left {
  margin-left: 30px;
}

.action-icon-circle {
  width: 50px;
  height: 50px;
  border-radius: 30px;
  background-color: #B8C2CC;
  display: flex;
}

.action-icon-circle .icon {
  color: rgba(255, 255, 255, 0.815);
  font-size: 25px;
  margin: auto;
}

.sidebar-spacer {
  position: relative;
  display: block;
  height: 100px;
}

.sidebar-spacer .close {
  position: absolute;
  right: 35px;
  top: 25px;
  color: #9ca5ad;
  font-size: 40px;
  cursor: pointer;
}

.nav-spacer {
  height: 70px;
  width: 100%;
  display: block;
}

.footer {
  width: 100vw;
}

.footer .footer-card {
  width: 100%;
}

.inline-block {
  display: inline-block;
}

.footer-icon-text {
  margin-left: 50px;
}

.footer-icon-text:first-of-type {
  margin-left: 0px;
}

/* OFFERS OVERVIEW ----------------------------------------------------------- OFFERS OVERVIEW */
.baseCard {
  position: relative;
  display: inline-block;
  width: 340px;
  border-radius: 2px;
  position: relative;
  margin-right: 30px;
  margin-bottom: 30px;
}
.baseCard.clickable {
  cursor: pointer;
}
.baseCard .card-title {
  display: block;
  margin: 0 !important;
}
.baseCard .headline {
  font-size: 17px !important;
  line-height: 17px !important;
  font-weight: 800;
  display: block;
  margin-top: -5px;
  margin-bottom: 14px;
}
.baseCard .status-container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background-color: #4cc541;
}
.baseCard .v-expansion-panel__header {
  padding: 0px !important;
}
.baseCard .v-expansion-panel__container {
  max-width: 100% !important;
}
.baseCard .v-card__text {
  padding: 10px 0px 0px 0px !important;
}
.baseCard .v-card__text div {
  padding-bottom: 10px;
}
.baseCard .v-expansion-panel__container--active {
  box-shadow: none !important;
}
.baseCard .v-expansion-panel--popout {
  margin-bottom: 0 !important;
}
.baseCard .margin-auto {
  margin: auto;
}
.baseCard .v-card__title {
  line-height: 1.15 !important;
}

.offer-content {
  min-width: 100%;
}

/* FILTERS --------------------------------------------------------------------- FILTERS */
.dropdownContainer {
  border-radius: 3px;
  padding: 0;
  min-width: 15em;
  width: 200px;
  display: inline-block;
  margin-right: 5px;
}
.dropdownContainer .basicDropdown {
  display: inline-block;
  outline-color: #3a9ef0;
  margin-right: 300px;
  width: 200px;
  cursor: pointer;
  border-radius: 5px;
  height: 50px;
}
.inputContainer {
  width: 300px;
  display: inline-block;
  margin-bottom: -35px;
  margin-top: -20px;
}
.inputContainer .basicInput {
  width: 100%;
}

/*# sourceMappingURL=style.css.map */

</style>
</head>

<body>
  <v-app id="app">
    <!-- Navigation -------------------------------------------------------------------------------------------------------->   
    <v-toolbar  absolute 
                dark 
                color="#3A9EF0"
                height="70px"
                scroll-off-screen>
      <v-toolbar-side-icon  @click.native.stop="sidebar = !sidebar"></v-toolbar-side-icon>
      <v-toolbar-title class="white--text">UFS Offer Dashboard</v-toolbar-title>
      <v-spacer></v-spacer>
      <img src="https://unilever-stage.neolane.net/res/unilever_stage/82b11d94f8b6e520f06ce3334218952d.png" alt="logo" class="navLogo">
      <v-spacer></v-spacer>
      <v-btn icon>
        <v-icon>search</v-icon>
      </v-btn>
      <v-btn icon>
        <v-icon>notifications_active</v-icon>
      </v-btn>
      <v-btn icon>
        <v-icon>person</v-icon>
      </v-btn>
    </v-toolbar>
    <v-navigation-drawer  v-model="sidebar"
                          absolute
                          width="400px"
                          temporary>
      <v-list>
        <div class="sidebar-spacer">
          <v-icon class="close"
                  @click="sidebar = false">
              close
          </v-icon>
        </div>
        <template v-for="subPage in subPages">
          <v-list-tile  :key="subPage.id"
                        @click="redirectTo(subPage.link)"
                        class="sidebar-tile">
            <v-list-tile-action class="action-margin-left">
              <div class="action-icon-circle">
                <v-icon color="white"
                        class="icon">
                  {{ subPage.icon }}
                </v-icon>
              </div>
            </v-list-tile-action>
            <v-subheader class="mx-4">
              {{ subPage.name }}
            </v-subheader>
          </v-list-tile>
        </template>
      </v-list>
    </v-navigation-drawer>
    <div class="nav-spacer"></div>
    <!-- Navigation ends -->

    <!-- Content -->
    <v-container grid-list-xl>
      <!-- Filters -------------------------------------------------------------------------------------------------------->
      <template v-if="filters != undefined">
        <v-container class="dropdownContainer">
          <v-select :items="filters.countries"
                    v-model="filtersSelected.country"
                    label="Country"
                    item-text="marketLabel"
                    item-value="marketCountryCode"
                    clearable dense single-line solo flat
                    class="basicDropdown"
                  :menu-props="{contentClass:'basicDropdownContent'}">
          </v-select>
        </v-container>
        <v-container class="dropdownContainer">
          <v-select :items="staticFilters.categories"
                    v-model="filtersSelected.category"
                    label="Category"
                    item-text="categoryLabel"
                    item-value="marketCountryCode"
                    clearable dense single-line solo flat
                    class="basicDropdown"
                  :menu-props="{contentClass:'basicDropdownContent'}">
          </v-select>
        </v-container>
        <v-container class="dropdownContainer">
          <v-select :items="filters.status"
                    v-model="filtersSelected.status"
                    label="Status"
                    item-text="name"
                    item-value="name"
                    clearable dense single-line solo flat
                    class="basicDropdown"
                    :menu-props="{contentClass:'basicDropdownContent'}">
          </v-select>
        </v-container>
        <v-container class="inputContainer">
          <v-text-field v-model="filtersSelected.label"
                        label="Label contains"
                        class="basicInput">
          </v-text-field>
        </v-container>
      </template>
      <!-- Filters end -->
      <v-divider ></v-divider>
      <!-- Search results ---------------------------------------------------------------------------------- -->
      <template v-if="offers.length">
        <v-hover v-for="(offer,i) in offers" :key="i">
          <v-card class="baseCard clickable align-top" 
                  align="top"
                  slot-scope="{ hover }"
                  :class="`elevation-${hover ? 12 : 2}`"
                  @click="openDetailView(offer)">
              <v-card-title primary-title class="card-title" >
                <div class="status-container"></div>
                <h3 class="headline" :title="offer.offerLabel">{{ offer.offerLabel | maxLength(33) }} </h3>
                <v-card-text>
                  <div><b>SL 1:</b>
                    {{offer.subject1}}</div>
                <div><b>SL 2:</b>
                    {{offer.subject2}}</div>
                <div><b>Pre Header:</b>
                  {{offer.preheader}}</div>
                </v-card-text>
              
              </v-card-title>
            <v-img v-if="offer.imageDesktopURL" :src="'https://'+offer.imageDesktopURL" aspect-ratio="2"></v-img>
            <v-card-title class="text-center center">
              <div v-if="offer.headline" class="margin-auto offer-content" style="font-family:Verdana; font-weight:bold; mso-line-height-rule:exactly; line-height:22px !important; font-size:21px; color:#ff5a00; padding:0 0 8px 0;">{{offer.headline}}</div>
              <div v-if="offer.copyText" class="offer-content" style="padding: 0 0 16px 0">{{offer.copyText}}</div>
              <div v-if="offer.CTAtext" style="margin: auto; padding:6px 14px; -webkit-border-radius:4px; border-radius:4px; font-size:14px; font-family:Verdana; color:#ffffff; display:inline-block; border:1px solid #ff5a00; background-color: #ff5a00;">
                <a :href="offer.destinationURL" style="font-size:14px; font-family:Verdana; text-decoration:none; font-weight:bold; mso-line-height-rule:exactly; line-height:14px !important; color:#ffffff;">{{offer.CTAtext}}</a>
              </div>
            </v-card-title>
          </v-card>
        </v-hover>
      </template>
      <template v-else>
        <v-container>There are no offers to display</v-container>
      </template>
      <div>
        <v-btn v-on:click="loadMoreOffers()" depressed large center>Load more</v-btn>
      </div>
      <!-- Search results end  -->
    </v-container>
    <!-- Detailed offer view -------------------------------------------------------------------------------------------------------->
    <v-dialog v-model="detailOfferView" 
              fullscreen hide-overlay 
              transition="dialog-bottom-transition"
              content-class="detailViewContent">
      <v-card v-if="detailOfferData != {}">
        <v-toolbar dark color="#FF5A00">
          <v-toolbar-title>{{ detailOfferData.offerLabel }}</v-toolbar-title>
          <v-spacer></v-spacer>
          <v-btn icon dark @click="closeDetailView()">
            <v-icon>close</v-icon>
          </v-btn>
        </v-toolbar>
        <v-container>
          <v-list>
            SOME CONTENT
          </v-list>
        </v-container>
      </v-card>
    </v-dialog>
    <!-- Detailed offer view ends -->
    <!-- Content ends -->

    <!-- Footer -------------------------------------------------------------------------------------------------------->
    <v-footer dark
              height="auto"
              class="footer">
      <v-card flat
              tile
              class="white--text text-xs-center footer-card">
        <v-card-text>
          <template v-for="icon in footerIcons">
            <p class="inline-block footer-icon-text">{{ icon.description }}</p>
            <v-btn  :key="icon.name"
                    class="mx-1 white--text"
                    icon>
              <v-icon size="24px">
                {{ icon.name }}
              </v-icon>
            </v-btn>
          </template>
          
        </v-card-text>
        <v-divider style="margin: 0;"></v-divider>
        <v-card-text class="white--text">
          <br>
          A member of WPP Group. &copy; 2019 — <strong>Wunderman</strong>
          <br>
          All Rights Reserved.
          <br><br>
        </v-card-text>
      </v-card>
    </v-footer>
    <!-- Footer ends -->
  </v-app>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <!-- bootstrap -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <!-- vue.js functionalities -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>

  <script>
    var vm = new Vue({
      el: '#app',
      filters: {
        maxLength: function(value, desiredLength) {
          if (!value) return '';
          value = value.toString();
          desiredLength = desiredLength*1;
          if(value.length > desiredLength) {
            //console.log('we here')
            return value.substring(0, desiredLength) + '...';
          } else {
            //console.log('we actually here '+ value.length +' '+ desiredLength)
            return value;
          }
        }
      },
      props: {
        offers: Array,
        filters: Object,
      },
      data: {
        isLoadingOffers: false,
        detailOfferView: false,
        detailOfferData: {},
        queryStartLine: 0,
        filtersSelected: {
          mco: '',
          umbrella: '',
          country: '',
          category: '',
          status: '',
          label: '',
        },
        sidebar: false,
        subPages: [
          {
            id: 1,
            name: 'Proofing dashboard',
            link: 'file:///C:/Users/antala/Documents/bc_peoject/bc_project/bc_project/campaign-dashboard.html',
            icon: 'list'
          },
          {
            id: 2,
            name: 'Offer dashboard',
            link: 'file:///C:/Users/antala/Documents/bc_peoject/bc_project/bc_project/index.html',
            icon: 'extension'
          },
          {
            id: 3,
            name: 'Settings',
            link: 'xyz',
            icon: 'settings'
          },
          {
            id: 4,
            name: 'FAQ',
            link: 'xyz',
            icon: 'help_outline'
          }
        ],
        socialIcons: [
          {
            name: 'tumblr',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/64a84557abe8e5b85db5872cd3f97b20.png"
          },
          {
            name: 'twitter',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/29ff2cc1aaf55cdd7d4d5048831d9ced.png"
          },
          {
            name: 'youtube',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/9f26d4ccd5ef9a6eb1b13ddaaac55069.png"
          },
          {
            name: 'whatsApp',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/96e103e615a88f2f7146aa1b6a29b348.png"
          },
          {
            name: 'facebook',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/ca3264cfa0247c069c8a311056f16c79.png"
          },
          {
            name: 'google',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/e84e8b411d47b36257d0cae80bf90b3e.png"
          },
          {
            name: 'instagram',
            link: "https://unilever-stage.neolane.net/res/unilever_stage/f74da9663a397434375dcea5ad26c2c6.png"
          }
          
        ],
        footerIcons: [
          {
            name: 'email',
            description: 'Email us:'
          },
          {
            name: 'call',
            description: 'Call us:'
          }
        ],
        staticFilters: {
          categories: [
            {
              categoryLabel: 'Recipe Recommendation',
              categoryRef: '_rcr'
            },
            {
              categoryLabel: 'Whitespot - Product',
              categoryRef: '_ws'
            },
            {
              categoryLabel: 'Deepsell',
              categoryRef: '_dps'
            },
            {
              categoryLabel: 'Digital Product Recommendation - Sample',
              categoryRef: '_dpr'
            },
            {
              categoryLabel: 'Hero Articles',
              categoryRef: '_ha'
            },
            {
              categoryLabel: 'Promotion and Activation',
              categoryRef: '_ha_proAct'
            },
            {
              categoryLabel: 'Inspiration',
              categoryRef: '_ha_inspr'
            },
            {
              categoryLabel: 'Secondary Articles',
              categoryRef: '_sa'
            },
            {
              categoryLabel: 'Competitions and Events',
              categoryRef: '_ce'
            },
            {
              categoryLabel: 'Competitions',
              categoryRef: '_ce_com'
            },
            {
              categoryLabel: 'Events',
              categoryRef: '_ce_event'
            },
            {
              categoryLabel: 'Chef Rewards',
              categoryRef: '_cr'
            },
            {
              categoryLabel: 'Chef Rewards Members',
              categoryRef: '_cr_crM'
            },{
              categoryLabel: 'Chef Rewards Non-Members',
              categoryRef: 'cr_crNonM'
            },{
              categoryLabel: 'Retention - Product',
              categoryRef: '_ret'
            },{
              categoryLabel: 'Article - Product',
              categoryRef: '_arc'
            },{
              categoryLabel: 'Recipe Recommendation V02',
              categoryRef: '_rcrv02'
            },{
              categoryLabel: 'Recipe Recommendation V03',
              categoryRef: '_rcrv03'
            },{
              categoryLabel: 'Upsell - Product',
              categoryRef: '_ups'
            }
          ],
          status: [
            {
              id: 15,
              name: 'Live'
            },
            {
              id: 16,
              name: 'Disabled'
            },
            {
              id: 17,
              name: 'To be approved'
            }
          ]
        }
      },
      watch: {
        'filtersSelected': {
          handler(val) {
            let caller = "filtering";
            this.loadOffers(val, caller);      
          },
          deep: true
        }
      },
      created() {
        this.loadFilters();
      },
      mounted() {
        let startPayload = {
          mco: '',
          umbrella: '',
          country: '',
          category: '',
          status: '',
        };
        this.loadOffers(startPayload, 'filtering');
      },
      methods: {
        loadOffers(payload, caller) {
          let baseUrl = 'https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardGetOffers.jssp';
          let hasUrlBeenAddedTo = false;
          console.log(payload)
          console.log(caller)
          if(payload.mco != '' && payload.mco != undefined && payload.mco != null){
            console.log('we in')
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?MCO='+payload.mco;
              hasUrlBeenAddedTo = true;
              console.log('we here')
            }else{
              baseUrl = baseUrl+'&MCO='+payload.mco;
              console.log('we here')
            }
          }
          if(payload.umbrella != '' && payload.umbrella != undefined && payload.umbrella != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?umbrella='+payload.umbrella;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&umbrella='+payload.umbrella;
            }
          }
          if(payload.country != '' && payload.country != undefined && payload.country != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?country='+payload.country;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&country='+payload.country;
            }
          }
          if(payload.category != '' && payload.category != undefined && payload.category != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?category='+payload.category;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&category='+payload.category;
            }
          }
          if(payload.status != '' && payload.status != undefined && payload.status != null){
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?status='+payload.status;
              hasUrlBeenAddedTo = true;
            }else{
              baseUrl = baseUrl+'&status='+payload.status;
            }
          }
          
          if(caller == "loadingMoreOffers"){
            console.log('we loading more offers')
            if(hasUrlBeenAddedTo == false){
              baseUrl = baseUrl+'?startLine='+vm.queryStartLine;
              hasUrlBeenAddedTo = true;

              console.log(baseUrl)
              axios.get(baseUrl).then(function(offerData){
                vm.offers = vm.offers.concat(offerData.data)

              })
            }else{
              baseUrl = baseUrl+'&startLine='+vm.queryStartLine;

              console.log(baseUrl)
              axios.get(baseUrl).then(function(offerData){
                vm.offers = vm.offers.concat(offerData.data)
              })
            }
          }else if(caller == "filtering"){
            console.log(this.queryStartLine)
            this.queryStartLine = 0;

            console.log(baseUrl)
            axios.get(baseUrl).then(function(offerData){
              vm.offers = offerData.data;
              console.log(offerData.data);
            })
          }

          
        },
        loadMoreOffers() {
        let caller = "loadingMoreOffers";  
        vm.queryStartLine += 12;
        vm.loadOffers(vm.filtersSelected, caller);
        },

        loadFilters() {
          axios.get('https://unilever-stage.neolane.net/ufs/TEST_OfferDashboardGetFilters.jssp').then(function(filterData){
          vm.filters = filterData.data;
          console.log(filterData.data);
          })
        },

        openDetailView(dataForOffer) {
          vm.detailOfferData = dataForOffer;
          vm.detailOfferView = true;
        },

        closeDetailView() {
          vm.detailOfferView = false;
          vm.detailOfferData = {};
        }

      }
    })
  </script>
</body>

</html>